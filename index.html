<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ব্লক ব্লাস্ট</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background-color: #2c3e50; /* Dark background */
            margin: 0;
            color: #ecf0f1;
            user-select: none;
        }

        .game-container {
            display: flex;
            gap: 30px;
            padding: 30px;
            background-color: #34495e; /* Slightly lighter dark */
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #e74c3c;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(8, 45px);
            grid-template-rows: repeat(8, 45px);
            border: 3px solid #7f8c8d;
            background-color: #95a5a6; /* Board background */
            border-radius: 5px;
        }

        .cell {
            width: 45px;
            height: 45px;
            box-sizing: border-box;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s ease;
        }
        
        .sidebar {
            width: 200px;
            padding: 20px;
            background-color: #2c3e50;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        #next-blocks {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }
        
        .block-option {
            display: grid;
            cursor: grab;
            border: 2px solid #7f8c8d;
            padding: 5px;
            background-color: #34495e;
            border-radius: 5px;
            transition: transform 0.1s ease;
        }
        
        .block-option:hover {
            transform: scale(1.05);
        }
        
        .block-option.dragging {
            opacity: 0.7;
            cursor: grabbing;
            transform: scale(1.1);
        }
        
        .block-cell {
            width: 20px;
            height: 20px;
            border: 1px solid rgba(0, 0, 0, 0.2);
            box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 30px 60px;
            border-radius: 15px;
            text-align: center;
            font-size: 24px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: none;
            z-index: 100;
        }
        
        .message button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #e74c3c;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .message button:hover {
            background-color: #c0392b;
        }
        
        #combo-message {
            font-size: 20px;
            font-weight: bold;
            color: #f1c40f;
            display: none;
            margin-top: 10px;
        }
        
        #score-info p {
            margin: 5px 0;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>ব্লক ব্লাস্ট</h1>
    <div class="game-container">
        <div id="game-board"></div>
        <div class="sidebar">
            <div id="score-info">
                <p>স্কোর: <span id="score">0</span></p>
                <p id="combo-message">কম্বো! +<span id="combo-points">0</span></p>
            </div>
            <div id="next-blocks">
                <p>পরবর্তী ব্লক:</p>
            </div>
        </div>
    </div>
    <div id="game-over-message" class="message">
        <p>গেম শেষ!</p>
        <p>আপনার স্কোর: <span id="final-score">0</span></p>
        <button onclick="window.location.reload()">আবার শুরু করুন</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const board = document.getElementById('game-board');
            const scoreDisplay = document.getElementById('score');
            const nextBlocksContainer = document.getElementById('next-blocks');
            const gameOverMessage = document.getElementById('game-over-message');
            const finalScoreDisplay = document.getElementById('final-score');
            const comboMessage = document.getElementById('combo-message');
            const comboPointsDisplay = document.getElementById('combo-points');

            const boardSize = 8;
            let grid = [];
            let score = 0;
            let comboCount = 0;
            let linesClearedInRow = 0;

            const blockShapes = [
                { shape: [[1]], color: '#e74c3c' },
                { shape: [[1, 1, 1]], color: '#3498db' },
                { shape: [[1], [1], [1]], color: '#2ecc71' },
                { shape: [[1, 1], [1, 1]], color: '#f1c40f' },
                { shape: [[1, 1, 1], [0, 1, 0]], color: '#9b59b6' },
                { shape: [[1, 1], [0, 1]], color: '#e67e22' },
                { shape: [[0, 1], [1, 1]], color: '#c0392b' },
            ];

            let currentBlockData = null;
            let dragging = false;

            function createBoard() {
                for (let i = 0; i < boardSize; i++) {
                    grid[i] = [];
                    for (let j = 0; j < boardSize; j++) {
                        const cell = document.createElement('div');
                        cell.classList.add('cell');
                        cell.dataset.x = j;
                        cell.dataset.y = i;
                        board.appendChild(cell);
                        grid[i][j] = 0;
                    }
                }
            }

            function generateNewBlocks() {
                nextBlocksContainer.innerHTML = '<p>পরবর্তী ব্লক:</p>';
                for (let i = 0; i < 3; i++) {
                    const randomBlock = blockShapes[Math.floor(Math.random() * blockShapes.length)];
                    createBlockOption(randomBlock);
                }
            }

            function createBlockOption(blockData) {
                const blockOption = document.createElement('div');
                blockOption.classList.add('block-option');
                blockOption.dataset.shape = JSON.stringify(blockData.shape);
                blockOption.dataset.color = blockData.color;
                blockOption.style.gridTemplateColumns = `repeat(${blockData.shape[0].length}, 20px)`;
                
                blockData.shape.forEach(row => {
                    row.forEach(cellValue => {
                        const blockCell = document.createElement('div');
                        if (cellValue === 1) {
                            blockCell.classList.add('block-cell');
                            blockCell.style.backgroundColor = blockData.color;
                        }
                        blockOption.appendChild(blockCell);
                    });
                });
                
                nextBlocksContainer.appendChild(blockOption);
            }

            function updateScore(lines) {
                if (lines > 0) {
                    comboCount++;
                    const baseScore = lines * 100;
                    const comboBonus = comboCount > 1 ? comboCount * 50 : 0;
                    const totalPoints = baseScore + comboBonus;
                    score += totalPoints;
                    scoreDisplay.textContent = score;
                    
                    if (comboCount > 1) {
                        comboPointsDisplay.textContent = comboBonus;
                        comboMessage.style.display = 'block';
                        setTimeout(() => comboMessage.style.display = 'none', 1000);
                    }
                } else {
                    comboCount = 0;
                }
            }

            function checkAndClearLines() {
                let linesToClear = new Set();

                // সারি চেক করা
                for (let i = 0; i < boardSize; i++) {
                    if (grid[i].every(cell => cell === 1)) {
                        for (let j = 0; j < boardSize; j++) {
                            linesToClear.add(`${j}-${i}`);
                        }
                    }
                }

                // কলাম চেক করা
                for (let j = 0; j < boardSize; j++) {
                    let columnIsFull = true;
                    for (let i = 0; i < boardSize; i++) {
                        if (grid[i][j] === 0) {
                            columnIsFull = false;
                            break;
                        }
                    }
                    if (columnIsFull) {
                        for (let i = 0; i < boardSize; i++) {
                            linesToClear.add(`${j}-${i}`);
                        }
                    }
                }
                
                const numCleared = linesToClear.size > 0 ? linesToClear.size / 8 : 0;
                if (numCleared > 0) {
                    linesToClear.forEach(pos => {
                        const [x, y] = pos.split('-').map(Number);
                        grid[y][x] = 0;
                        const cellElement = board.querySelector(`[data-x="${x}"][data-y="${y}"]`);
                        cellElement.style.backgroundColor = '';
                    });
                    updateScore(numCleared);
                } else {
                    comboCount = 0;
                }
            }

            function canPlaceBlock(shape, startX, startY) {
                for (let i = 0; i < shape.length; i++) {
                    for (let j = 0; j < shape[i].length; j++) {
                        if (shape[i][j] === 1) {
                            const x = startX + j;
                            const y = startY + i;
                            if (x >= boardSize || y >= boardSize || grid[y][x] !== 0) {
                                return false;
                            }
                        }
                    }
                }
                return true;
            }

            function placeBlock(shape, startX, startY, color) {
                for (let i = 0; i < shape.length; i++) {
                    for (let j = 0; j < shape[i].length; j++) {
                        if (shape[i][j] === 1) {
                            const x = startX + j;
                            const y = startY + i;
                            grid[y][x] = 1;
                            const cellElement = board.querySelector(`[data-x="${x}"][data-y="${y}"]`);
                            cellElement.style.backgroundColor = color;
                        }
                    }
                }
            }
            
            function checkGameOver() {
                const remainingBlocks = document.querySelectorAll('.block-option');
                let canPlaceAnyBlock = false;

                remainingBlocks.forEach(blockElement => {
                    const shape = JSON.parse(blockElement.dataset.shape);
                    for (let i = 0; i < boardSize; i++) {
                        for (let j = 0; j < boardSize; j++) {
                            if (canPlaceBlock(shape, j, i)) {
                                canPlaceAnyBlock = true;
                                break;
                            }
                        }
                        if (canPlaceAnyBlock) break;
                    }
                });

                if (!canPlaceAnyBlock) {
                    finalScoreDisplay.textContent = score;
                    gameOverMessage.style.display = 'block';
                }
            }

            // ইভেন্ট লিসেনার্স
            nextBlocksContainer.addEventListener('mousedown', (e) => {
                const blockOption = e.target.closest('.block-option');
                if (blockOption) {
                    currentBlockData = {
                        element: blockOption,
                        shape: JSON.parse(blockOption.dataset.shape),
                        color: blockOption.dataset.color,
                    };
                    blockOption.classList.add('dragging');
                    dragging = true;
                }
            });

            board.addEventListener('mousemove', (e) => {
                if (dragging && currentBlockData) {
                    // এটি Drag and drop করার জন্য মাউস এর অবস্থান ট্র্যাক করে
                    // কিন্তু এর ভিজ্যুয়াল ইফেক্ট আরও জটিল, তাই এটি সহজভাবে করা হলো
                    const cell = e.target.closest('.cell');
                    if (cell) {
                        const x = parseInt(cell.dataset.x);
                        const y = parseInt(cell.dataset.y);
                        // এখানে ব্লকটি হাইলাইট করার লজিক যুক্ত করা যেতে পারে
                    }
                }
            });

            board.addEventListener('mouseup', (e) => {
                if (dragging && currentBlockData) {
                    const cell = e.target.closest('.cell');
                    if (cell) {
                        const x = parseInt(cell.dataset.x);
                        const y = parseInt(cell.dataset.y);

                        if (canPlaceBlock(currentBlockData.shape, x, y)) {
                            placeBlock(currentBlockData.shape, x, y, currentBlockData.color);
                            currentBlockData.element.remove();
                            checkAndClearLines();
                            
                            if (document.querySelectorAll('.block-option').length === 1) {
                                generateNewBlocks();
                            } else {
                                checkGameOver();
                            }
                        }
                    }
                }
                if (currentBlockData) {
                    currentBlockData.element.classList.remove('dragging');
                }
                dragging = false;
                currentBlockData = null;
            });
            
            // মাউস ছেড়ে দিলে drag বন্ধ করে
            document.addEventListener('mouseup', () => {
                if (currentBlockData) {
                    currentBlockData.element.classList.remove('dragging');
                }
                dragging = false;
                currentBlockData = null;
            });

            createBoard();
            generateNewBlocks();
        });
    </script>
</body>
</html>
